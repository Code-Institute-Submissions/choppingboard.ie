{% extends "base.html" %} 

{% block title %} {{ recipe.recipe_name }} {% endblock %}

{% block content %}
<h1>{{ recipe.recipe_name }}</h1>
{% load thumbnail %}

<div class="row">
    <div class="column">
        <div class="row">
                <video width="320" height="240" controls>
                  <source src="{{MEDIA_URL}}{{recipe.video}}" type="video/mp4">
                  <source src="{{MEDIA_URL}}{{recipe.video}}" type="video/ogg">
                  Your browser does not support the video tag.
                </video>
                       
      
                    {% thumbnail recipe.image "300x240" crop="100%" as im %}
                        <img src="{{ im.url }}" class="image-detail image-size img-thumbnail">
                    {% endthumbnail %}
            </div>
            
            <div class="row cook-desc">    
                    <a href="{% url 'user_detail' recipe.cook %}">
                    <h5 class="avatar-cook-name"><img src="{{ MEDIA_URL }}{{ recipe.cook.profile.image }}" class="img-circle"> {{ recipe.cook.username }}</h5>
                    </a>
            </div>
                    
                <div class="row">
                    <span class="date-views">Published on: {{ recipe.created_date.date }} - Views:{{ recipe.views }}</span>
                </div>
                
                <div class="row likes">    
                {% with total_likes=recipe.users_like.count users_like=recipe.users_like.all %}
                <span class="count">
                    <i class="fas fa-heart fa-2x heart"></i><span class="total">{{ total_likes }}</span>
                </span>
                
                {% if request.user.is_authenticated %}
                <a href="#" data-id="{{ recipe.id }}" data-action="{% if request.user in users_like %}un{% endif %}like" class="like button">
                    {% if request.user not in users_like %}
                    Like 
                    {% else %}
                    Unlike
                    {% endif %}
                </a>
                {% endif %}
                </div>
                
                <span>
                {% for user in recipe.users_like.all %}
                        <img src="{{ MEDIA_URL }}{{ user.profile.image }}" class="img-circle">
                        
                    {% endfor %}
                {% endwith %}
                </span>
                
                <div>
                    <span><i class="fas fa-utensils"></i> Type of cuisine:</span>
                    <p>{{recipe.cusine_type}}</p>
                    
                    <span><i class="fas fa-apple-alt"></i> Diet type:</span>
                    <p>{{recipe.diet_type}}</p>
                    
                    <span><i class="fas fa-carrot"></i> Ingredients:</span><br>
                    <p class="recipe-layout">{{recipe.ingredients}}</p>
                    
                    <span><i class="fas fa-hamburger"></i> Preparation:</span>
                    <p class="recipe-layout w3-panel">{{recipe.preparation}}</p>
                </div>
                    
                    {% if request.user == recipe.cook %}
                    <a href="{% url 'recipes:edit_recipe' recipe.id %}" class="btn btn-primary">Edit Recipe</a>
                    <a href="{% url 'recipes:delete_recipe' recipe.id %}" class="btn btn-primary">Delete Recipe</a>
                    {% endif %}
    </div>
</div>                

{% endblock content %}


{% block domready %}

$('a.like').click(function(e){
e.preventDefault();
$.post('{% url "recipes:like" %}',
{
id: $(this).data('id'),
action: $(this).data('action')
},
function(data){
if (data['status'] == 'ok')
{
var previous_action = $('a.like').data('action');
// toggle data-action
$('a.like').data('action', previous_action == 'like' ? 'unlike' : 'like');
// toggle link text
$('a.like').text(previous_action == 'like' ? 'Unlike' : 'Like');
// update total likes
var previous_likes = parseInt($('span.count .total').text());
$('span.count .total').text(previous_action == 'like' ? previous_likes + 1 : previous_likes - 1);
}
}
);
});

{% endblock %}



